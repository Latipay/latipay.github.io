

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Merchant Hosted Offline/Hardware</title>
    <meta charset="utf-8">
    <meta name="description" content="Latipay">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Merchant Hosted Offline/Hardware">
    <meta property="og:description" content="Latipay">
    <meta property="og:image" content="https://latipay.net//images/logo.png">

    <link rel="icon" href="https://merchant.latipay.net/favicon.ico">

    <meta name="msapplication-TileColor" content="#4fc08d">
    <meta name="theme-color" content="#4fc08d">

    <meta name="msapplication-config" content="browserconfig.xml">
    <link rel="manifest" href="/manifest.json">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'>

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- main page styles -->
    <link rel="stylesheet" href="/css/page.css">

    <script>window.PAGE_TYPE = "v2"</script>

  </head>
  <body class="docs">
    <div id="mobile-bar" >
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>
    <div id="header">
  <a id="logo" href="/">
    <img src="/images/logo.svg">
  </a>

  <ul id="nav">
    <!-- <li>
  	  <a href="/api-console/index.html" class="nav-link">API Console</a>
  	</li> -->

    <li>
  	  <a href="/v2_cn/index.html" class="nav-link">中文</a>
  	</li>

	  <li>
	    <a href="/v2/index.html" class="nav-link">English</a>
	  </li>
  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
        
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <div class="list">
      <h2>
        V2
      </h2>
      <ul class="menu-root">
  
    <li>
      <a href="/v2/index.html" class="sidebar-link">Introduction</a>
    </li>
  
    <li>
      <a href="/v2/latipay-hosted-online.html" class="sidebar-link">Latipay Hosted Online</a>
    </li>
  
    <li>
      <a href="/v2/merchant-hosted-offline.html" class="sidebar-link current">Merchant Hosted Offline/Hardware</a>
    </li>
  
    <li>
      <a href="/v2/latipay-barcode.html" class="sidebar-link">Barcode Payment</a>
    </li>
  
    <li>
      <a href="/v2/latipay-wechat-mini-app.html" class="sidebar-link">Wechat Mini App Payment</a>
    </li>
  
    <li>
      <a href="/v2/invoice.html" class="sidebar-link">Latipay Invoice</a>
    </li>
  
    <li>
      <a href="/v2/error-code.html" class="sidebar-link">Error Code</a>
    </li>
  
</ul>

    </div>
  </div>
</div>


<div class="content v2 with-sidebar ">
  
    
      
    
  
  
    <h1>Merchant Hosted Offline/Hardware</h1>
  
  <p><a href="http://doc.latipay.net/api-console/merchant-host.html" target="_blank" rel="noopener">API Playground</a></p>
<p class="tip">Tips: Get your <code>Wallet ID</code>, <code>User ID</code> and <code>API key</code> via <a href="https://merchant.latipay.net/account" target="__blank">Latipay Merchant Portal</a> &gt; Account &gt; Show hidden values<br>Tips: Create a minimum amount product (e.g. $ 0.01 NZD/AUD) for testing.</p>

<p>This API will return <code>QR code</code> in a diagramatic format along with the Transaction and Payment Interfaces.</p>
<p><strong> Available Payment Methods </strong></p>
<ul>
<li>Alipay (Customised QR Code payment page)</li>
<li>WeChat Pay (Customised QR Code payment page)</li>
</ul>
<h2 id="How-it-works"><a href="#How-it-works" class="headerlink" title="How it works?"></a>How it works?</h2><p>Alipay Or WeChat with Server</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="/images/merchant_hosted_offline_wechat_alipay.jpg" alt=""></h2><p>Alipay Or WeChat without Server</p>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="/images/merchant_hosted_offline_wechat_alipay_without_server.jpg" alt=""></h2><h2 id="Payment-Scenarios"><a href="#Payment-Scenarios" class="headerlink" title="Payment Scenarios"></a>Payment Scenarios</h2><p>Alipay<br><img src="/images/merchant_hosted_offline_alipay.png" alt=""></p>
<hr>
<p>WeChat<br><img src="/images/merchant_hosted_offline_wechat.png" alt=""></p>
<hr>
<h2 id="API-Details"><a href="#API-Details" class="headerlink" title="API Details"></a>API Details</h2><h3 id="1-Latipay-Transaction-Interface"><a href="#1-Latipay-Transaction-Interface" class="headerlink" title="1 - Latipay Transaction Interface"></a>1 - Latipay Transaction Interface</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST https://api.latipay.net/v2/transaction</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br></pre></td></tr></table></figure>
<p><a href="http://doc.latipay.net/api-console/merchant-host.html?api=/v2/transaction" target="_blank" rel="noopener">API Playground</a></p>
<p>Demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl \</span><br><span class="line">-X POST \</span><br><span class="line">-H &quot;Content-Type: application/json;charset=UTF-8&quot; \</span><br><span class="line">-d &apos;&#123;&quot;signature&quot;:&quot;a60318f763c88d7f4efe9cec33342f0d303233bd0ded2bc6902b1cc867790411&quot;,&quot;wallet_id&quot;:&quot;W00000001&quot;,&quot;amount&quot;:&quot;120.00&quot;,&quot;user_id&quot;:&quot;U000334333&quot;,&quot;merchant_reference&quot;:&quot;dsi39ej430sks03&quot;,&quot;return_url&quot;:&quot;&quot;,&quot;callback_url&quot;:&quot;https://merchantsite.com/confirm&quot;,&quot;ip&quot;:&quot;122.122.122.1&quot;,&quot;version&quot;:&quot;2.0&quot;,&quot;product_name&quot;:&quot;Pinot Noir, Otago&quot;,&quot;payment_method&quot;:&quot;alipay&quot;,&quot;host_type&quot; :&quot;1&quot;&#125;&apos; \</span><br><span class="line">https://api.latipay.net/v2/transaction</span><br></pre></td></tr></table></figure>
<h4 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters:"></a>Parameters:</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>String</td>
<td>The user account you want to use to process the transaction.</td>
<td>NO</td>
</tr>
<tr>
<td>wallet_id</td>
<td>String</td>
<td>The ID of the wallet you want to use.</td>
<td>NO</td>
</tr>
<tr>
<td>amount</td>
<td>String</td>
<td>A decimal amount.</td>
<td>NO</td>
</tr>
<tr>
<td>merchant_reference</td>
<td>String</td>
<td>A <code>unique id</code> identifying the order in Merchant’s system.</td>
<td>NO</td>
</tr>
<tr>
<td>payment_method</td>
<td>String</td>
<td>Payment method options are <code>alipay</code> and <code>wechat</code>.</td>
<td>NO</td>
</tr>
<tr>
<td>return_url</td>
<td>String</td>
<td>The URL of the landing page where Latipay will return the customer after payment when successful or failed.</td>
<td>NO</td>
</tr>
<tr>
<td>callback_url</td>
<td>String</td>
<td>Merchant webserver’s URL that the payment result will send to.</td>
<td>NO</td>
</tr>
<tr>
<td>ip</td>
<td>String</td>
<td>The IP address of the customer.</td>
<td>NO</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>The latest version of the platform. must be <code>&quot;2.0&quot;</code></td>
<td>NO</td>
</tr>
<tr>
<td>product_name</td>
<td>String</td>
<td>The name of the product or service being sold.</td>
<td>NO</td>
</tr>
<tr>
<td>host_type</td>
<td>String</td>
<td>must be <code>&quot;1&quot;</code>, for <a href="#2-Payment-Interface">#Payment Interface</a> to return <code>QR code picture</code> in base64</td>
<td>NO</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>The SHA-256 HMAC API signature.</td>
<td>NO</td>
</tr>
</tbody>
</table>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"wallet_id"</span>: <span class="string">"W00000001"</span>,</span><br><span class="line">  <span class="attr">"amount"</span>: <span class="string">"120.00"</span>,</span><br><span class="line">  <span class="attr">"user_id"</span>: <span class="string">"U000334333"</span>,</span><br><span class="line">  <span class="attr">"merchant_reference"</span>: <span class="string">"dsi39ej430sks03"</span>,</span><br><span class="line">  <span class="attr">"return_url"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"callback_url"</span>: <span class="string">"https://merchantsite.com/confirm"</span>,</span><br><span class="line">  <span class="attr">"ip"</span>: <span class="string">"122.122.122.1"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="attr">"product_name"</span>: <span class="string">"Pinot Noir, Otago"</span>,</span><br><span class="line">  <span class="attr">"payment_method"</span>: <span class="string">"alipay"</span>,</span><br><span class="line">  <span class="attr">"host_type"</span> : <span class="string">"1"</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">"signature"</span>: <span class="string">"a60318f763c88d7f4efe9cec33342f0d303233bd0ded2bc6902b1cc867790411"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SHA-256-HMAC-Signature-Try-your-signature-online"><a href="#SHA-256-HMAC-Signature-Try-your-signature-online" class="headerlink" title="SHA-256 HMAC Signature Try your signature online"></a>SHA-256 HMAC Signature <a href="https://jsfiddle.net/tonnyLTP/wj36tey4/45/" target="_blank" rel="noopener">Try your signature online</a></h4><p>Rearrange all parameters alphabetically (except parameters with value of <code>null</code> or <code>empty</code> string) and join them with <code>&amp;</code>, and concat the value of <code>api_key</code> in the end.</p>
<p>JS code example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.keys(data)</span><br><span class="line">  .filter(<span class="function"><span class="params">item</span> =&gt;</span> data[item] != <span class="literal">null</span> &amp;&amp; data[item] != <span class="literal">undefined</span> &amp;&amp; data[item] !== <span class="string">''</span>)</span><br><span class="line">  .sort()</span><br><span class="line">  .map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;item&#125;</span>=<span class="subst">$&#123;data[item]&#125;</span>`</span>)</span><br><span class="line">  .join(<span class="string">'&amp;'</span>)</span><br><span class="line">  .concat(api_key)</span><br></pre></td></tr></table></figure>
<p>Example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">message: amount=120.00&amp;callback_url=https://merchantsite.com/confirm&amp;host_type=1&amp;ip=122.122.122.1&amp;merchant_reference=dsi39ej430sks03&amp;payment_method=alipay&amp;product_name=Pinot Noir, Otago&amp;user_id=U000334333&amp;version=2.0&amp;wallet_id=W00000001111222333</span><br><span class="line">secret(your api_key): 111222333</span><br><span class="line"></span><br><span class="line">signature: a60318f763c88d7f4efe9cec33342f0d303233bd0ded2bc6902b1cc867790411</span><br></pre></td></tr></table></figure>
<h4 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>Int</td>
<td>0 means success.</td>
</tr>
<tr>
<td>host_url</td>
<td>String</td>
<td>The url for request a QR code picture. The nonce should be appended to the end.</td>
</tr>
<tr>
<td>nonce</td>
<td>String</td>
<td>The transaction nonce must be appended to the host_url URL. Please make sure it always be fresh, <code>Do not save it</code> for using later.</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>The SHA-256 HMAC API signature.</td>
</tr>
</tbody>
</table>
<h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"code"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"message"</span>: <span class="string">"SUCCESS"</span>,</span><br><span class="line">  <span class="attr">"host_url"</span>: <span class="string">"https://api.latipay.net/v2/merchanthosted/gatewaydata"</span>,</span><br><span class="line">  <span class="attr">"nonce"</span>: <span class="string">"7d5a88119354301ad3fc250404493bd27abf4467283a061d1ed11860a46e1bf3"</span>,</span><br><span class="line">  <span class="attr">"signature"</span>: <span class="string">"14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Signature-in-Response"><a href="#Signature-in-Response" class="headerlink" title="Signature in Response"></a>Signature in Response</h4><p>For security reasons, we highly recommend you verify the signature in the response.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">message: nonce + host_url</span><br><span class="line">secret: api_key</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="2-Payment-Interface"><a href="#2-Payment-Interface" class="headerlink" title="2 - Payment Interface"></a>2 - Payment Interface</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#123;host_url&#125;/&#123;nonce&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Example-2"><a href="#Example-2" class="headerlink" title="Example"></a>Example</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.latipay.net/v2/merchanthosted/gatewaydata/7d5a88119354301ad3fc250404493bd27abf4467283a061d1ed11860a46e1bf3</span><br></pre></td></tr></table></figure>
<h4 id="Response-1"><a href="#Response-1" class="headerlink" title="Response"></a>Response</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>Integer</td>
<td>The response code of payment, <code>0</code> or <a href="https://doc.latipay.net/v2/error-code.html" target="_blank" rel="noopener">Error Code</a>, 0 means no error happened.</td>
</tr>
<tr>
<td>message</td>
<td>String</td>
<td>The response message of payment interface.</td>
</tr>
<tr>
<td>data</td>
<td>Object</td>
<td>Contains <code>QR code picture</code> and order information.</td>
</tr>
</tbody>
</table>
<p>the <code>data</code> object</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>order_id</td>
<td>String</td>
<td>A unique transaction identifier generated by Latipay.</td>
</tr>
<tr>
<td>nonce</td>
<td>String</td>
<td>A unique transaction nonce generated by Latipay.</td>
</tr>
<tr>
<td>payment_method</td>
<td>String</td>
<td>Payment method options are alipay and wechat.</td>
</tr>
<tr>
<td>amount</td>
<td>String</td>
<td>A decimal amount.</td>
</tr>
<tr>
<td>amount_cny</td>
<td>String</td>
<td>A decimal amount.</td>
</tr>
<tr>
<td>currency</td>
<td>String</td>
<td>The currency code of the transaction.</td>
</tr>
<tr>
<td>product_name</td>
<td>String</td>
<td>The name of the product or service being sold.</td>
</tr>
<tr>
<td>organisation_id</td>
<td>Integer</td>
<td>The merchant id which is used to process the transaction.</td>
</tr>
<tr>
<td>organisation_name</td>
<td>String</td>
<td>The merchant’s name</td>
</tr>
<tr>
<td>user_id</td>
<td>String</td>
<td>The user account which is used to process the transaction.</td>
</tr>
<tr>
<td>user_name</td>
<td>String</td>
<td>The user account’s name</td>
</tr>
<tr>
<td>wallet_id</td>
<td>String</td>
<td>The user wallet account which is used to process the transaction.</td>
</tr>
<tr>
<td>wallet_name</td>
<td>String</td>
<td>The wallet account’s name</td>
</tr>
<tr>
<td>qr_code</td>
<td>String</td>
<td>The QR code picture</td>
</tr>
<tr>
<td>qr_code_url</td>
<td>String</td>
<td>The QR code text version, you can generate QR code picture with it.</td>
</tr>
<tr>
<td>currency_rate</td>
<td>String</td>
<td>The rate which is used to the transaction.</td>
</tr>
<tr>
<td>merchant_reference</td>
<td>String</td>
<td>A <code>unique id</code> identifying the order in Merchant’s system.</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>The <code>SHA-256 HMAC</code> API signature.</td>
</tr>
</tbody>
</table>
<h4 id="Example-3"><a href="#Example-3" class="headerlink" title="Example"></a>Example</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"SUCCESS"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: &#123;</span><br><span class="line">      order_id: "20180411000011",</span><br><span class="line">      nonce: "9cbd6620180411115539ca7260dd01f54c5f8977b262256828",</span><br><span class="line">      payment_method: "wechat",</span><br><span class="line">      amount: 0.02,</span><br><span class="line">      amount_cny: 0.09,</span><br><span class="line">      currency: "NZD",</span><br><span class="line">      product_name: "food",</span><br><span class="line">      organisation_id: 1,</span><br><span class="line">      organisation_name: "123123",</span><br><span class="line">      user_id: "U00001534",</span><br><span class="line">      user_name: "abcdefghijklmnopqrstuvwxyz",</span><br><span class="line">      wallet_id: "W00000001",</span><br><span class="line">      wallet_name: "test account",</span><br><span class="line">      qr_code: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAEz0lEQVR42u3dSW7kMBAEQP3/0zMvMGDAVGUWFQX4JnWLS/QhTZHPP6XUj/XoAqUAUQoQpQBRChClAFFqN5DneWr+ft2gX957+jtS7f3T4P/hWSbubehnQAABBBBAAAEEEEAAAQSQaiCpgWvC0DQpT1+3sU/f/F5AAAEEEEAAAQQQQAABBJB1QE6nCKmJkEphUm3b+AM4jRoQQAABBBBAAAEEEEAAAQSQoiULt6R2qcQKEEAAAQQQQAABBBBAAAEEECnWeLVPttNLTQABBBBAAAEEEEAAAQQQQAApBbKxA1ObNmzs56Z7p9sLCCCAAAIIIIAAAggggABSDaRpBzzX3XOdrUcBcR0ggLgOEEBcBwggrgPEGYWvJiRN6Vlqk4r142pqAwIIIIAAAggggAACCCDbgHztvL+mSbkxTdo0DwABBBBAAAEEEEAAAQQQQKqBpDYJ2PjuQqptN2+iMf0sgAACCCCAAAIIIIAAAggg1UAmGpJaopH6vFSCmJqUre9+AAIIIIAAAggggAACCCCAXLvUpH0pwvaBa0zA2tOu2KYNgAACCCCAAAIIIIAAAggg6Z0Vmz4vVamE7nRfpb4j1VeAAAIIIIAAAggggAACCCCVQCZSk4lUoimFaV8y0778pD7mBQQQQAABBBBAAAEEEEAAmfxP+sbOP31veztuhl4f8wICCCCAAAIIIIAAAggggLwFJJWutKNpOnswNXk3vicDCCCAAAIIIIAAAggggACyGsjXNjto3xgiNWFS49awwQUggAACCCCAAAIIIIAAAkgNkKZlJam062s7PzalihOfBwgggAACCCCAAAIIIIAAAshw4pJCfQv+dqxXp1iAAAIIIIAAAggggAACCCCNE/r0IE0kVqfvnYAkUQMEEEAAAQQQQAABBBBAAPkwkBSajUCa2pZKnaafDxBAAAEEEEAAAQQQQAABpBrIjbvnfXXin/5xak8aAQEEEEAAAQQQQAABBBBAVgNp3wr/FphN4E4/88S9gAACCCCAAAIIIIAAAggggCzfPOHmnQYtmQmeUQgIIIAAAggggAACCCCAAJI+J70d19feo2gao6Z2AAIIIIAAAggggAACCCCArAbSkCK8NcCpH4SmJSRNk7w1LQQEEEAAAQQQQAABBBBAALninfSJTmhK3ibQbDzuYQJmVcwLCCCAAAIIIIAAAggggAAy+Z/09gndlJDckrK1Tt6JZAsQQAABBBBAAAEEEEAAAaQGSKpxTQlO0w9He9tuSe0AAQQQQAABBBBAAAEEEEAqgbRX+yC1p063nG/4ZoIICCCAAAIIIIAAAggggACy7viDW84o/Np7KE2TN5XGAQIIIIAAAggggAACCCCArAaSSqcmAKcSpo2bNrSnWKeeDxBAAAEEEEAAAQQQQAABZB2Qje9qtA7I5GRrTy4bkjxAAAEEEEAAAQQQQAABBBBASnfZO9H5E+8zNG3asL0PAAEEEEAAAQQQQAABBBBAAAl1YKq9pyflxLOkEjApFiCAAAIIIIAAAggggAACSOn7IE0T6+ZjF96cgO2fBwgggAACCCCAAAIIIIAAUg3k5mMDvrYBQtP3NqWjgAACCCCAAAIIIIAAAgggzklXqrAAUQoQpQBRChClAFEKEKUAUWp1/Qf6j3VUKG0J3AAAAABJRU5ErkJggg==",</span><br><span class="line">      qr_code_url: "weixin://wxpay/bizpayurl?pr=hmU9BXs",</span><br><span class="line">      currency_rate: "4.64490",</span><br><span class="line">      merchant_reference: "M00001543-000001",</span><br><span class="line">      signature: "15e8f83c0e3cddbec01b0ee135d958d872d21498bd29ff6defc2eb2f11b11108"</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SHA-256-HMAC-Signature"><a href="#SHA-256-HMAC-Signature" class="headerlink" title="SHA-256 HMAC Signature"></a>SHA-256 HMAC Signature</h4><p>Rearrange all parameters in the <code>data</code> alphabetically (except <code>signature</code> and other parameters with value of <code>null</code> or <code>empty</code> string) and join rearranged parameters with <code>&amp;</code>, and concat the value of <code>api_key</code> in the end.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">message: amount=0.02&amp;amount_cny=0.09&amp;currency=NZD&amp;currency_rate=4.65776&amp;merchant_reference=M00001543-000001&amp;nonce=41226220180411114422fdfdba5d94f84fdc873f0f9ea6d5a6&amp;order_id=20180411000009&amp;organisation_id=1&amp;organisation_name=123123&amp;payment_method=alipay&amp;product_name=food&amp;qr_code=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAE+klEQVR42u3dQW7jMBAEQP//07v3BfYQmNPTZKqBnJzYscQSMKQ0/PwRkf/m4xCIACICiAggIoCIACICiAggIoCIACIigIgAIgKICCAigIgAIgKICCD/vtHnE/05/f/+9Pv89P2+/f3T3+/03397PNvGByCAAAIIIIAAAggg9wFJn/BtUNsD8NsB+e3xvv2CAAgggAACCCCAAALIe0CmT1j7ADkNenuAbhfxgAACCCCAAAIIIIAA0n4Atv/+NMBpoOkLCiCAAAIIIIAAAggggPy2Ij19s93p4337zY+AAAIIIIAAAggggACyXcROF63TA3wa3PT3a1tY3Rp/gAACCCCAAAIIIIBo2pBaqPL67kKgriaAAAIIIF4HBBCvA9KeaVDt4LcXYl8NIIAAAggggAACCCDvAkkXZW2ATg/A0zdjTi/MtiwMAgIIIIAAAggggAByL5DtInEaQBpk+viePv/bF0RAAAEEEEAAAQQQQN4Dkm6C0Dag25tKpH9/e7wAAggggAACCCCAAPI+kJaFnVsWLrebRmxPgqQXFgEBBBBAAAEEEEAAAWT679tvfnxtEmH689culIAAAggggAACCCCA1AJpazJwWzPlNLDp85e+4AECCCCAAAIIIIAAAsjpL9y2aabXsxfIX7eJJyCAAAKI1wEBxOuAxBcGv/287Y3r0xeA228Grf0/AQEEEEAAAQQQQAB5BkjbwlJ7E4Pf1ljv13VWBAQQQAABBBBAAAFkvUg+/XntRWNbU4b0Ba91UgIQQAABBBBAAAEEkHuK9OkT2tYE4bYHxtomWQABBBBAAAEEEEAAASRdtKeLzOmf05MY6aK+vYgGBBBAAAEEEEAAAQSQ9EP96fe/rUje3nQzPUkCCCCAAAIIIIAAAggg7QtR20VqGnS6SG5b+AQEEEAAAQQQQAABBJDp5sSvbZo5/XnTx7N9UgQQQAABBBBAAAEEkPuBtC2UtU06tB+v9g1vnu9qAggggAACCCCAAAJIHND2A0zpB4TaN8RpWzi9rkgHBBBAAAEEEEAAASS+UNi+0JYu0tMLd6813otdGAABBBBAAAEEEEAAeQZIe/Pjtg2B0jd3pic1dDUBBBBAAAEEEEAAASS9kHS6KGsrOqcXHtsmOdrOJyCAAAIIIIAAAggg7wGZPiC3NyrbbizX3vy7tVEeIIAAAggggAACCCD3FumnQW1vIDMN+jbwbRcYQAABBBBAAAEEEEDeBzJeLIWLtNuaNrQ9kHYa1FYRDwgggAACCCCAAALIO43j0kXibQ/4bDfKay2a4xdmQAABBBBAAAEEEEBqgUwfsLYB2lbUbw/g9g13AAEEEEAAAQQQQAB5D8h6MRV+QCj9/0xPgrRtIAQIIIAAAggggAACCCDpA9w2wNo3DW1buEwfX0AAAQQQQAABBBBAAJkuwr/9/O0HoNJNGbbPz/QFChBAAAEEEEAAAQQQQNqKvOmitb2oTy/MvnLzIiCAAAIIIIAAAggggLQ0fZieVGhritAODhBAAAEEEEAAAQQQQNqAbDeVuH3Ty9smAQABBBBAAAEEEEAAAST9/rdvInp7E4fpSYvY5AQggAACCCCAAAIIINcASd+8Nl10pl+/rfHd6fGxPUkACCCAAAIIIIAAAkg/EJEXA4gIICKAiAAiAogIICKAiAAiAogIICICiAggIoCIACICiAggIoCIPJO/H7l2LoSyTzgAAAAASUVORK5CYII=&amp;qr_code_url=https://qr.alipay.com/bax08151zdenrj3nltzi80a9&amp;user_id=U00001534&amp;user_name=abcdefghijklmnopqrstuvwxyz&amp;wallet_id=W00000001&amp;wallet_name=test accountXXXXXXXXX</span><br><span class="line">secret(your api_key): XXXXXXXXX</span><br></pre></td></tr></table></figure>
<p>JS code example:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.keys(data)</span><br><span class="line">  .filter(<span class="function"><span class="params">item</span> =&gt;</span> item !== <span class="string">'signature'</span>)</span><br><span class="line">  .sort()</span><br><span class="line">  .map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;item&#125;</span>=<span class="subst">$&#123;data[item]&#125;</span>`</span>)</span><br><span class="line">  .join(<span class="string">'&amp;'</span>)</span><br><span class="line">  .concat(<span class="string">'XXXXXXXXX'</span>)</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="3-Payment-Result-Asynchronous-Notification"><a href="#3-Payment-Result-Asynchronous-Notification" class="headerlink" title="3 - Payment Result Asynchronous Notification"></a>3 - Payment Result Asynchronous Notification</h3><p>Asynchronous Notification is a re-try mechanism to ensure the notification has been updated to the merchant’s web server. There is no times limitation until it returns an indicating <code>sent</code> text to Latipay. The time interval of this notification is about 30 seconds.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST merchant&apos;s callback_url</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br></pre></td></tr></table></figure>
<p class="tip">The status of response must be <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/200" target="_blank" rel="noopener">200</a>, the body of response must be the string <code>send</code></p>

<h4 id="Parameters-1"><a href="#Parameters-1" class="headerlink" title="Parameters:"></a>Parameters:</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>merchant_reference</td>
<td>String</td>
<td>A <code>unique id</code> identifying the order in Merchant’s system.</td>
</tr>
<tr>
<td>currency</td>
<td>String</td>
<td>The currency code of the transaction.</td>
</tr>
<tr>
<td>amount</td>
<td>String</td>
<td>A decimal amount.</td>
</tr>
<tr>
<td>payment_method</td>
<td>String</td>
<td>The payment method used. Possible values are alipay and wechat.</td>
</tr>
<tr>
<td>status</td>
<td>String</td>
<td>The status of the transaction. Possible values are: pending, paid, or failed.</td>
</tr>
<tr>
<td>pay_time</td>
<td>String</td>
<td>Show the payment time of the transaction order.</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>The <code>SHA-256 HMAC</code> API signature.</td>
</tr>
</tbody>
</table>
<h4 id="Example-input"><a href="#Example-input" class="headerlink" title="Example input"></a>Example input</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"merchant_reference"</span>: <span class="string">"dsi39ej430sks03"</span>,</span><br><span class="line">  <span class="attr">"currency"</span>: <span class="string">"AUD"</span>,</span><br><span class="line">  <span class="attr">"amount"</span>: <span class="string">"120.00"</span>,</span><br><span class="line">  <span class="attr">"payment_method"</span>: <span class="string">"wechat"</span>,</span><br><span class="line">  <span class="attr">"status"</span>: <span class="string">"paid"</span>,</span><br><span class="line">  <span class="attr">"pay_time"</span>: <span class="string">"2017-07-07 10:53:50"</span></span><br><span class="line"></span><br><span class="line">  <span class="string">"signature"</span>: <span class="string">"14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SHA-256-HMAC-Signature-1"><a href="#SHA-256-HMAC-Signature-1" class="headerlink" title="SHA-256 HMAC Signature"></a>SHA-256 HMAC Signature</h4><p>Merchant backend needs to validate the signature for protecting against malicious requests.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">message: merchant_reference + payment_method + status + currency + amount</span><br><span class="line">secret: api_key</span><br></pre></td></tr></table></figure>
<h4 id="Expected-response"><a href="#Expected-response" class="headerlink" title="Expected response"></a>Expected response</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sent</span><br></pre></td></tr></table></figure>
<h3 id="4-Payment-Result-Interface"><a href="#4-Payment-Result-Interface" class="headerlink" title="4 - Payment Result Interface"></a>4 - Payment Result Interface</h3><p>All customers can send requests to query payment status with merchant order id(that should be <code>unique id</code> for the merchant) as merchant_reference by HTTP GET request.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.latipay.net/v2/transaction/&#123;merchant_reference&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://doc.latipay.net/api-console/merchant-host.html?api=/v2/transaction/{merchant_reference}" target="_blank" rel="noopener">API Playground</a></p>
<h4 id="Parameters-2"><a href="#Parameters-2" class="headerlink" title="Parameters"></a>Parameters</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>merchant_reference</td>
<td>String</td>
<td>A <code>unique id</code> identifying the order in Merchant’s system.</td>
<td>NO</td>
</tr>
<tr>
<td>user_id</td>
<td>String</td>
<td>The user account you want to use to process the transaction.</td>
<td>NO</td>
</tr>
<tr>
<td>is_block</td>
<td>Int</td>
<td>Optional parameter, <code>1</code> means the http request use long poolling mechanism, the timeout is 180s.</td>
<td>YES</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>The <code>SHA-256 HMAC</code> API signature.</td>
<td>NO</td>
</tr>
</tbody>
</table>
<h4 id="SHA-256-HMAC-Signature-2"><a href="#SHA-256-HMAC-Signature-2" class="headerlink" title="SHA-256 HMAC Signature"></a>SHA-256 HMAC Signature</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">message: merchant_reference + user_id</span><br><span class="line">secret: api_key</span><br></pre></td></tr></table></figure>
<h4 id="Example-4"><a href="#Example-4" class="headerlink" title="Example"></a>Example</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.latipay.net/v2/transaction/1289323A122DB?user_id=U000334333&amp;signature=14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3</span><br></pre></td></tr></table></figure>
<h4 id="Response-2"><a href="#Response-2" class="headerlink" title="Response"></a>Response</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>merchant_reference</td>
<td>String</td>
<td>A <code>unique id</code> identifying the order in Merchant’s system.</td>
</tr>
<tr>
<td>order_id</td>
<td>String</td>
<td>A unique transaction identifier generated by Latipay.</td>
</tr>
<tr>
<td>currency</td>
<td>String</td>
<td>The currency code of the transaction.</td>
</tr>
<tr>
<td>amount</td>
<td>String</td>
<td>A decimal amount.</td>
</tr>
<tr>
<td>payment_method</td>
<td>String</td>
<td>The payment method used. Possible values are alipay and wechat.</td>
</tr>
<tr>
<td>status</td>
<td>String</td>
<td>The status of the transaction. Possible values are: pending, paid, or failed.</td>
</tr>
<tr>
<td>pay_time</td>
<td>String</td>
<td>Show the payment time of the transaction order. <code>UTC/GMT+08:00</code></td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>The <code>SHA-256 HMAC</code> API signature.</td>
</tr>
</tbody>
</table>
<h4 id="Example-Response"><a href="#Example-Response" class="headerlink" title="Example Response"></a>Example Response</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"merchant_reference"</span>: <span class="string">"dsi39ej430sks03"</span>,</span><br><span class="line">  <span class="attr">"order_id"</span>: <span class="string">"2017232323345670"</span>,</span><br><span class="line">  <span class="attr">"currency"</span>: <span class="string">"AUD"</span>,</span><br><span class="line">  <span class="attr">"amount"</span>: <span class="string">"120.00"</span>,</span><br><span class="line">  <span class="attr">"payment_method"</span>: <span class="string">"wechat"</span>,</span><br><span class="line">  <span class="attr">"status"</span>: <span class="string">"paid"</span>,</span><br><span class="line">  <span class="attr">"pay_time"</span>: <span class="string">"2017-07-07 10:53:50"</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">"signature"</span>: <span class="string">"14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Signature-in-Response-1"><a href="#Signature-in-Response-1" class="headerlink" title="Signature in Response"></a>Signature in Response</h4><p>For security reasons, we highly recommend you verify the signature in the response.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">message: merchant_reference + payment_method + status + currency + amount</span><br><span class="line">secret: api_key</span><br></pre></td></tr></table></figure>
<h4 id="Example-Signature"><a href="#Example-Signature" class="headerlink" title="Example Signature"></a>Example Signature</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">message: dsi39ej430sks03alipaypaidNZD120.00</span><br><span class="line">secret(your api_key): 111222333</span><br><span class="line"></span><br><span class="line">signature: 840151e0dc39496e22b410b83058b4ddd633b786936c505ae978fae029a1e0f1</span><br></pre></td></tr></table></figure>
<h3 id="5-Refund"><a href="#5-Refund" class="headerlink" title="5 - Refund"></a>5 - Refund</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST https://api.latipay.net/refund</span><br></pre></td></tr></table></figure>
<p><a href="http://doc.latipay.net/api-console/merchant-host.html?api=/refund" target="_blank" rel="noopener">API Playground</a></p>
<h4 id="Parameters-3"><a href="#Parameters-3" class="headerlink" title="Parameters"></a>Parameters</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>String</td>
<td>The user account you want to use to process the transaction.</td>
</tr>
<tr>
<td>order_id</td>
<td>String</td>
<td>A unique transaction identifier generated by Latipay.</td>
</tr>
<tr>
<td>refund_amount</td>
<td>String</td>
<td>A decimal amount. e.g. “9.99”, cannot be in excess of order amount.</td>
</tr>
<tr>
<td>reference</td>
<td>String</td>
<td>Notes about this refund.</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>The <code>SHA-256 HMAC</code> API signature.</td>
</tr>
</tbody>
</table>
<p>Example</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"user_id"</span>: <span class="string">"U000334333"</span>,</span><br><span class="line">  <span class="attr">"order_id"</span>: <span class="string">"23479798sdf7987234"</span>,</span><br><span class="line">  <span class="attr">"refund_amount"</span>: <span class="string">"120.00"</span>,</span><br><span class="line">  <span class="attr">"reference"</span>: <span class="string">"notes about this refund"</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">"signature"</span>: <span class="string">"3052b51072570b743bf9a12a20a45b0adf280aee84907ef0e54d1079fb3f961c"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SHA-256-HMAC-Signature-3"><a href="#SHA-256-HMAC-Signature-3" class="headerlink" title="SHA-256 HMAC Signature"></a>SHA-256 HMAC Signature</h4><p>Rearrange all parameters alphabetically (except parameters with value of <code>null</code> or <code>empty</code> string) and join them with <code>&amp;</code>, and concat the value of <code>api_key</code> in the end.</p>
<p>JS code example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.keys(data)</span><br><span class="line">  .filter(<span class="function"><span class="params">item</span> =&gt;</span> data[item] != <span class="literal">null</span> &amp;&amp; data[item] != <span class="literal">undefined</span> &amp;&amp; data[item] !== <span class="string">''</span>)</span><br><span class="line">  .sort()</span><br><span class="line">  .map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;item&#125;</span>=<span class="subst">$&#123;data[item]&#125;</span>`</span>)</span><br><span class="line">  .join(<span class="string">'&amp;'</span>)</span><br><span class="line">  .concat(api_key)</span><br></pre></td></tr></table></figure>
<p>Example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">message: order_id=23479798sdf7987234&amp;reference=notes about this refund&amp;refund_amount=120.00&amp;user_id=U000334333111222333</span><br><span class="line">secret(your api_key): 111222333</span><br><span class="line"></span><br><span class="line">signature: 3052b51072570b743bf9a12a20a45b0adf280aee84907ef0e54d1079fb3f961c</span><br></pre></td></tr></table></figure>
<h4 id="Response-3"><a href="#Response-3" class="headerlink" title="Response"></a>Response</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>String</td>
<td>The response code of payment, 0 or Error Code, 0 means no error happened.</td>
</tr>
<tr>
<td>message</td>
<td>String</td>
<td>The response message of payment interface.</td>
</tr>
</tbody>
</table>
<h4 id="Example-Response-1"><a href="#Example-Response-1" class="headerlink" title="Example Response"></a>Example Response</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"code"</span>: <span class="number">0</span>,</span><br><span class="line">  "message": "", //the reason when error happened</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-Cancel-Transaction"><a href="#6-Cancel-Transaction" class="headerlink" title="6 - Cancel Transaction"></a>6 - Cancel Transaction</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST https://api.latipay.net/cancel</span><br></pre></td></tr></table></figure>
<p><a href="http://doc.latipay.net/api-console/merchant-host.html?api=/cancel" target="_blank" rel="noopener">API Playground</a></p>
<h4 id="Parameters-4"><a href="#Parameters-4" class="headerlink" title="Parameters"></a>Parameters</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>String</td>
<td>The user account you want to use to process the transaction.</td>
</tr>
<tr>
<td>merchant_reference</td>
<td>String</td>
<td>A <code>unique id</code> identifying the order in Merchant’s system.</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>The <code>SHA-256 HMAC</code> API signature.</td>
</tr>
</tbody>
</table>
<p>Example</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"user_id"</span>:<span class="string">"U000000013"</span>,</span><br><span class="line">  <span class="attr">"merchant_reference"</span>:<span class="string">"9872428736782682"</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">"signature"</span>: <span class="string">"3052b51072570b743bf9a12a20a45b0adf280aee84907ef0e54d1079fb3f961c"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SHA-256-HMAC-Signature-4"><a href="#SHA-256-HMAC-Signature-4" class="headerlink" title="SHA-256 HMAC Signature"></a>SHA-256 HMAC Signature</h4><p>Rearrange all parameters alphabetically (except parameters with value of <code>null</code> or <code>empty</code> string) and join them with <code>&amp;</code>, and concat the value of <code>api_key</code> in the end.</p>
<p>JS code example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.keys(data)</span><br><span class="line">  .filter(<span class="function"><span class="params">item</span> =&gt;</span> data[item] != <span class="literal">null</span> &amp;&amp; data[item] != <span class="literal">undefined</span> &amp;&amp; data[item] !== <span class="string">''</span>)</span><br><span class="line">  .sort()</span><br><span class="line">  .map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;item&#125;</span>=<span class="subst">$&#123;data[item]&#125;</span>`</span>)</span><br><span class="line">  .join(<span class="string">'&amp;'</span>)</span><br><span class="line">  .concat(api_key)</span><br></pre></td></tr></table></figure>
<p>Example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">message: user_id=U000000013&amp;merchant_reference=9872428736782682111222333</span><br><span class="line">secret(your api_key): 111222333</span><br><span class="line"></span><br><span class="line">signature: da3b80be09665913e632f1bc0822e3d98d8dd235aebeb6f532b6bb7e329b9635</span><br></pre></td></tr></table></figure>
<h4 id="Response-4"><a href="#Response-4" class="headerlink" title="Response"></a>Response</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>String</td>
<td>The response code of payment, 0 or Error Code, 0 means no error happened.</td>
</tr>
<tr>
<td>message</td>
<td>String</td>
<td>The response message of payment interface.</td>
</tr>
</tbody>
</table>
<h4 id="Example-Response-2"><a href="#Example-Response-2" class="headerlink" title="Example Response"></a>Example Response</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"code"</span>: <span class="number">0</span>,</span><br><span class="line">  "message": "", //the reason when error happened</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><table>
<thead>
<tr>
<th>Code</th>
<th>Message</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>success</td>
<td>cancellation success</td>
</tr>
<tr>
<td>1</td>
<td>FAIL</td>
<td>cancellation failed，you can submit another request after at least 15 minutes</td>
</tr>
<tr>
<td>3</td>
<td>data error</td>
<td>parameters in request body are illlegal</td>
</tr>
<tr>
<td>110</td>
<td>User not exist</td>
<td>user specified by user_id doesn’t exist</td>
</tr>
<tr>
<td>201</td>
<td>order not exist</td>
<td>can’t find the transaction order by merchant_reference</td>
</tr>
<tr>
<td>205</td>
<td>Can not find out corresponding key for the user code or user is disabled or user is not activity</td>
<td>can’t get api key by user_id</td>
</tr>
<tr>
<td>206</td>
<td>Signature from Merchant request is wrong</td>
<td>signature is not correct</td>
</tr>
<tr>
<td>900</td>
<td>transaction has been successfully completed</td>
<td>can’t cancel this transaction, because it has been completed successfully</td>
</tr>
<tr>
<td>901</td>
<td>transaction has been failed</td>
<td>can’t cancel this transaction, because it has been failed</td>
</tr>
</tbody>
</table>

  
    <div class="guide-links">
      
        <span>← <a href="/v2/latipay-hosted-online.html">Latipay Hosted Online</a></span>
      
      
        <span style="float: right;"><a href="/v2/latipay-barcode.html">Barcode Payment</a> →</span>
      
    </div>
  
  <div class="footer">
  </div>
</div>

        
      </div>
      <script src="/js/smooth-scroll.min.js"></script>
    

    <!-- main custom script for sidebars, version selects etc. -->
    <script src="/js/css.escape.js"></script>
    <script src="/js/common.js"></script>


    <!-- fastclick -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      FastClick.attach(document.body)
    }, false)
    </script>
  </body>
</html>

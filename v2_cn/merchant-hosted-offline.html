

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Merchant Hosted Offline/Hardware</title>
    <meta charset="utf-8">
    <meta name="description" content="Latipay">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Merchant Hosted Offline/Hardware">
    <meta property="og:description" content="Latipay">
    <meta property="og:image" content="https://latipay.net//images/logo.png">

    <link rel="icon" href="https://merchant.latipay.net/favicon.ico">

    <meta name="msapplication-TileColor" content="#4fc08d">
    <meta name="theme-color" content="#4fc08d">

    <meta name="msapplication-config" content="browserconfig.xml">
    <link rel="manifest" href="/manifest.json">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'>

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- main page styles -->
    <link rel="stylesheet" href="/css/page.css">

    <script>window.PAGE_TYPE = "v2_cn"</script>

  </head>
  <body class="docs">
    <div id="mobile-bar" >
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>
    <div id="header">
  <a id="logo" href="/">
    <img src="/images/logo.svg">
  </a>

  <ul id="nav">
    <li>
  	  <a href="/v2_cn/index.html" class="nav-link">中文</a>
  	</li>
    
	  <li>
	    <a href="/v2/index.html" class="nav-link">English</a>
	  </li>
  </ul>
</div>
    
      <div id="main" class="fix-sidebar">
        
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <div class="list">
      <h2>
        V2_cn
      </h2>
      <ul class="menu-root">
  
    <li>
      <a href="/v2_cn/index.html" class="sidebar-link">Latipay Hosted</a>
    </li>
  
    <li>
      <a href="/v2_cn/merchant-hosted-online.html" class="sidebar-link">Merchant Hosted Online/E-Commerce</a>
    </li>
  
    <li>
      <a href="/v2_cn/merchant-hosted-offline.html" class="sidebar-link current">Merchant Hosted Offline/Hardware</a>
    </li>
  
</ul>

    </div>
  </div>
</div>


<div class="content v2_cn with-sidebar ">
  
    
      
    
  
  
    <h1>Merchant Hosted Offline/Hardware</h1>
  
  <p><a href="https://pay.latipay.net/api-console-merchant-hosted-offline" target="_blank" rel="noopener">在线测试API</a></p>
<p class="tip">1. 集成Latipay API需要提前准备好Wallet ID, User ID 和 API key。 <a href="https://merchant.latipay.net/account" target="__blank">Latipay Merchant Portal</a> &gt; Account &gt; Show hidden values；<br>2. 对应的Wallet ID需要事先开通alipay，wechat或者onlineBank权限；<br>3. 请勿泄漏api_key；<br>4. 测试时可以支付最小金额$0.01。</p>

<p>这个API支持返回二维码图片和订单信息</p>
<h2 id="支持的支付方式"><a href="#支持的支付方式" class="headerlink" title="支持的支付方式"></a>支持的支付方式</h2><ul>
<li>支付宝</li>
<li>微信支付</li>
</ul>
<h2 id="支付流程图"><a href="#支付流程图" class="headerlink" title="支付流程图"></a>支付流程图</h2><p>支付宝或者微信支付</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="/images/merchant_hosted_offline_wechat_alipay.jpg" alt=""></h2><h2 id="支付场景"><a href="#支付场景" class="headerlink" title="支付场景"></a>支付场景</h2><p>支付宝<br><img src="/images/merchant_hosted_offline_alipay.png" alt=""></p>
<hr>
<p>微信支付<br><img src="/images/merchant_hosted_offline_wechat.png" alt=""></p>
<hr>
<h2 id="API-列表"><a href="#API-列表" class="headerlink" title="API 列表"></a>API 列表</h2><h3 id="1-下单"><a href="#1-下单" class="headerlink" title="1. 下单"></a>1. 下单</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST https://api.latipay.net/v2/transaction</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br></pre></td></tr></table></figure>
<p>Demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl \</span><br><span class="line">-X POST \</span><br><span class="line">-H &quot;Content-Type: application/json;charset=UTF-8&quot; \</span><br><span class="line">-d &apos;&#123;&quot;signature&quot;:&quot;14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3&quot;,&quot;wallet_id&quot;:&quot;W00000001&quot;,&quot;amount&quot;:&quot;120.00&quot;,&quot;user_id&quot;:&quot;U000334333&quot;,&quot;merchant_reference&quot;:&quot;dsi39ej430sks03&quot;,&quot;return_url&quot;:&quot;&quot;,&quot;callback_url&quot;:&quot;https://merchantsite.com/confirm&quot;,&quot;ip&quot;:&quot;122.122.122.1&quot;,&quot;version&quot;:&quot;2.0&quot;,&quot;product_name&quot;:&quot;Pinot Noir, Otago&quot;,&quot;payment_method&quot;:&quot;alipay&quot;,&quot;host_type&quot; :&quot;1&quot;&#125;&apos; \</span><br><span class="line">https://api.latipay.net/v2/transaction</span><br></pre></td></tr></table></figure>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
<th>可选</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>String</td>
<td>商户账号用户 id</td>
<td>No</td>
</tr>
<tr>
<td>wallet_id</td>
<td>String</td>
<td>商户账号wallet id</td>
<td>No</td>
</tr>
<tr>
<td>payment_method</td>
<td>String</td>
<td>支付方式 <code>wechat</code>, <code>alipay</code>, or <code>onlineBank</code></td>
<td>No</td>
</tr>
<tr>
<td>amount</td>
<td>String</td>
<td>支付金额</td>
<td>No</td>
</tr>
<tr>
<td>return_url</td>
<td>String</td>
<td>支付完成后浏览器继续加载的地址</td>
<td>No</td>
</tr>
<tr>
<td>callback_url</td>
<td>String</td>
<td>支付完成后异步通知地址</td>
<td>No</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>参数签名，算法为SHA-256 HMAC</td>
<td>No</td>
</tr>
<tr>
<td>merchant_reference</td>
<td>String</td>
<td>商户订单号</td>
<td>No</td>
</tr>
<tr>
<td>ip</td>
<td>String</td>
<td>客户端ip</td>
<td>No</td>
</tr>
<tr>
<td>version</td>
<td>String</td>
<td>版本号 <code>&quot;2.0&quot;</code></td>
<td>No</td>
</tr>
<tr>
<td>product_name</td>
<td>String</td>
<td>订单产品标题</td>
<td>No</td>
</tr>
<tr>
<td>host_type</td>
<td>String</td>
<td>值必须为<code>&quot;1&quot;</code>， 支付接口会返回一张二维码图片（Base64格式）</td>
<td>No</td>
</tr>
</tbody>
</table>
<h4 id="参数例子"><a href="#参数例子" class="headerlink" title="参数例子"></a>参数例子</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"signature"</span>: <span class="string">"14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3"</span>,</span><br><span class="line">  <span class="attr">"wallet_id"</span>: <span class="string">"W00000001"</span>,</span><br><span class="line">  <span class="attr">"amount"</span>: <span class="string">"120.00"</span>,</span><br><span class="line">  <span class="attr">"user_id"</span>: <span class="string">"U000334333"</span>,</span><br><span class="line">  <span class="attr">"merchant_reference"</span>: <span class="string">"dsi39ej430sks03"</span>,</span><br><span class="line">  <span class="attr">"return_url"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"callback_url"</span>: <span class="string">"https://merchantsite.com/confirm"</span>,</span><br><span class="line">  <span class="attr">"ip"</span>: <span class="string">"122.122.122.1"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="attr">"product_name"</span>: <span class="string">"Pinot Noir, Otago"</span>,</span><br><span class="line">  <span class="attr">"payment_method"</span>: <span class="string">"alipay"</span>,</span><br><span class="line">  <span class="attr">"host_type"</span> : <span class="string">"1"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参数-SHA-256-HMAC-签名"><a href="#参数-SHA-256-HMAC-签名" class="headerlink" title="参数 SHA-256 HMAC 签名"></a>参数 SHA-256 HMAC 签名</h4><p>将所有参数按字母表顺序从小到大排序（去掉其中值为null和空字符串的项），然后以key=value和&amp;形式拼接，最后加上api_key</p>
<p>JS代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Object.keys(data)</span><br><span class="line">  .filter(item =&gt; data[item] != null &amp;&amp; data[item] != undefined &amp;&amp; data[item] !== &apos;&apos;)</span><br><span class="line">  .sort()</span><br><span class="line">  .map(item =&gt; `$&#123;item&#125;=$&#123;data[item]&#125;`)</span><br><span class="line">  .join(&apos;&amp;&apos;)</span><br><span class="line">  .concat(api_key)</span><br></pre></td></tr></table></figure></p>
<h4 id="签名例子"><a href="#签名例子" class="headerlink" title="签名例子"></a>签名例子</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">待签名文本: amount=120.00&amp;callback_url=https://merchantsite.com/confirm&amp;host_type=1&amp;ip=122.122.122.1&amp;merchant_reference=dsi39ej430sks03&amp;payment_method=alipay&amp;product_name=Pinot Noir, Otago&amp;signature=14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3&amp;user_id=U000334333&amp;version=2.0&amp;wallet_id=W00000001111222333</span><br><span class="line">密钥: 111222333</span><br><span class="line"></span><br><span class="line">签名结果: a60318f763c88d7f4efe9cec33342f0d303233bd0ded2bc6902b1cc867790411</span><br></pre></td></tr></table></figure>
<h4 id="请求结果"><a href="#请求结果" class="headerlink" title="请求结果"></a>请求结果</h4><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>host_url</td>
<td>String</td>
<td>供浏览器加载的url，使用url和nonce可以完成下一步支付</td>
</tr>
<tr>
<td>nonce</td>
<td>String</td>
<td>订单的唯一编号</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>服务器端签名，算法为SHA-256 HMAC</td>
</tr>
</tbody>
</table>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"host_url"</span>: <span class="string">"https://api.latipay.net/merchanthosted/gatewaydata"</span>,</span><br><span class="line">  <span class="attr">"nonce"</span>: <span class="string">"7d5a88119354301ad3fc250404493bd27abf4467283a061d1ed11860a46e1bf3"</span>,</span><br><span class="line">  <span class="attr">"signature"</span>: <span class="string">"14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="signature-服务器端签名"><a href="#signature-服务器端签名" class="headerlink" title="signature 服务器端签名"></a>signature 服务器端签名</h4><p>服务器端返回结果前，会对nonce + host_url加密，商户端需要进行验证，以保证该请求的合法性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">待签名文本: nonce + host_url</span><br><span class="line">密钥: api_key</span><br></pre></td></tr></table></figure>
<h3 id="2-支付"><a href="#2-支付" class="headerlink" title="2. 支付"></a>2. 支付</h3><p>加载以下地址继续支付订单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;host_url&#125;/&#123;nonce&#125;</span><br></pre></td></tr></table></figure>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.latipay.net/merchanthosted/gatewaydata/7d5a88119354301ad3fc250404493bd27abf4467283a061d1ed11860a46e1bf3</span><br></pre></td></tr></table></figure>
<h4 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h4><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>Integer</td>
<td>0 表示接口请求成功</td>
</tr>
<tr>
<td>message</td>
<td>String</td>
<td>接口出错时附加的信息</td>
</tr>
<tr>
<td>data</td>
<td>Object</td>
<td>包含二维码和订单信息</td>
</tr>
</tbody>
</table>
<ul>
<li><code>data</code>包含的数据</li>
</ul>
<table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>order_id</td>
<td>String</td>
<td>Latipay订单的唯一编码</td>
</tr>
<tr>
<td>nonce</td>
<td>String</td>
<td>Latipay订单的临时唯一编码</td>
</tr>
<tr>
<td>payment_method</td>
<td>String</td>
<td>支付方式，值为<code>alipay</code> 或者 <code>wechat</code></td>
</tr>
<tr>
<td>amount</td>
<td>String</td>
<td>支付金额</td>
</tr>
<tr>
<td>amount_cny</td>
<td>String</td>
<td>支付人民币金额</td>
</tr>
<tr>
<td>currency</td>
<td>String</td>
<td>支付货币</td>
</tr>
<tr>
<td>product_name</td>
<td>String</td>
<td>购买的产品名称</td>
</tr>
<tr>
<td>organisation_id</td>
<td>Integer</td>
<td>商户编码</td>
</tr>
<tr>
<td>org_name</td>
<td>String</td>
<td>商户名称</td>
</tr>
<tr>
<td>user_id</td>
<td>String</td>
<td>商户的用户id</td>
</tr>
<tr>
<td>user_name</td>
<td>String</td>
<td>商户用户名</td>
</tr>
<tr>
<td>wallet_id</td>
<td>String</td>
<td>用户付款到该账号下</td>
</tr>
<tr>
<td>wallet_name</td>
<td>String</td>
<td>账号名称</td>
</tr>
<tr>
<td>qr_code</td>
<td>String</td>
<td>二维码图片（Base64格式）</td>
</tr>
<tr>
<td>qr_code_url</td>
<td>String</td>
<td>二维码文本</td>
</tr>
<tr>
<td>currency_rate</td>
<td>String</td>
<td>当前的汇率</td>
</tr>
<tr>
<td>merchant_reference</td>
<td>String</td>
<td>商户系统中订单的唯一编码</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>接口参数签名</td>
</tr>
</tbody>
</table>
<h4 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"SUCCESS"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: &#123;</span><br><span class="line">        <span class="attr">"order_id"</span>: <span class="string">"20180112000003"</span>,</span><br><span class="line">        <span class="attr">"nonce"</span>: <span class="string">"fd270820180112103849a19380c7300c425898780b3d0b1fbc"</span>,</span><br><span class="line">        <span class="attr">"payment_method"</span>: <span class="string">"wechat"</span>,</span><br><span class="line">        <span class="attr">"amount"</span>: <span class="number">0.01</span>,</span><br><span class="line">        <span class="attr">"amount_cny"</span>: <span class="number">0.05</span>,</span><br><span class="line">        <span class="attr">"currency"</span>: <span class="string">"AUD"</span>,</span><br><span class="line">        <span class="attr">"product_name"</span>: <span class="string">"产品中文"</span>,</span><br><span class="line">        <span class="attr">"organisation_id"</span>: <span class="number">695</span>,</span><br><span class="line">        <span class="attr">"organisation_name"</span>: <span class="string">"126Emai"</span>,</span><br><span class="line">        <span class="attr">"user_id"</span>: <span class="string">"U000000266"</span>,</span><br><span class="line">        <span class="attr">"user_name"</span>: <span class="string">"04_oliver"</span>,</span><br><span class="line">        <span class="attr">"wallet_id"</span>: <span class="string">"W000000329"</span>,</span><br><span class="line">        <span class="attr">"wallet_name"</span>: <span class="string">"AUD_01"</span>,</span><br><span class="line">        <span class="attr">"qr_code"</span>: <span class="string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAEzUlEQVR42u3dS27cQAwE0Ln/pZMTGDBgDVlFPQLZaWBJzadFpT+ff0qpH+vjFSgFiFKAKAWIUoAoBYhS3UA+n0/Mv18/0C9/2/hsf3nev7yDrd8mvHtAAAEEEEAAAQQQQAABBJBoICPJwR9e9MSAPP1sE8+7dS+NfQUIIIAAAggggAACCCCAAFIN5Olm27ru6SZPSrEm7iUpaQQEEEAAAQQQQAABBBBAAAEkAMiV6SJJCV06akAAAQQQQAABBBBAAAEEEECKUqzGaSAT0za2ki1AAAEEEEAAAQQQQAABBBBAvgjkbS9w4u+mY7UeBBBAAAEEEEAAAQQQQAABJABI0lQO1925ztajgLgOEEBcBwggrgMEENcB8uIzCtPXYEw821bKVtUngAACCCCAAAIIIIAAAgggbUAm1iRcnlay1ZTpiWTChwgQQAABBBBAAAEEEEAAASQaSOMRBhO/3RrM9CMWJhK6b94LIIAAAggggAACCCCAAAJINJCkZCsJ3JWdFbeuSz2yARBAAAEEEEAAAQQQQAABpA5IelpzZcdEzfv8cwACCCCAAAIIIIAAAggggNQAedsB91tp0uUUq71fAAEEEEAAAQQQQAABBBBAYoBsJTNJCdMEhulk5hquqJgXEEAAAQQQQAABBBBAAAFk8n/SJxKIK03euDviFq7UzTsAAQQQQAABBBBAAAEEEEBigEwnBs2JS2MTbR1/kJR6AgIIIIAAAggggAACCCCA1AC5stlB+ll8SSnblaTsTMwLCCCAAAIIIIAAAggggADSkjCl7/jXCH0rGdxCAwgggAACCCCAAAIIIIAAAkjANIut9OzxAQxaT5M01eRMigUIIIAAAggggAACCCCAAJLY0Fs79F1pyq0mb0/UAAEEEEAAAQQQQAABBBBAXgVkK4naevlX1mUkJXTfvD9AAAEEEEAAAQQQQAABBJAYIJeTisvJVuN7OXM+CCCAAAIIIIAAAggggAACyCSQLUjpzTa9mcB24yc070TyBggggAACCCCAAAIIIIAAEgMkaeAaz/tLeo705K0yxQIEEEAAAQQQQAABBBBAAJkEkv7yG481SGqE9F0jE5I8QAABBBBAAAEEEEAAAQSQGCBbaU1SqtOY/mjy554NEEAAAQQQQAABBBBAAAEkBsjW1Iatw+ev7CCYvv6laVoOIIAAAggggAACCCCAAAJIDJD0Bkw/B7FxLUn6zooTfQoIIIAAAggggAACCCCAABIJ5PIajK2kDLiuMQIEEGMECCDGCBBAAAEEEEDqUqytShrg9CZKnxoy8YEGBBBAAAEEEEAAAQQQQACpBrI1wG/bxKBx3U16yvbY2AACCCCAAAIIIIAAAggggCQDSUqntqYxSMDyU6yn7g8QQAABBBBAAAEEEEAAAaQOSOOZgt98qZNNnv7RSf+IAQIIIIAAAggggAACCCCAAFIEZGKaReOUmfRjF9bOKAQEEEAAAQQQQAABBBBAAHkrkMYzBSfSs63pIlIsQAABBBBAAAEEEEAAAQSQACATDdiYuDQmOEnnTQICCCCAAAIIIIAAAggggAAynEpc3lBhKxncSveSUrGn7gUQQAABBBBAAAEEEEAAASQGiFJvL0CUAkQpQJQCRClAlAJEKUCUqq7/Vhpz81YibhcAAAAASUVORK5CYII="</span>,</span><br><span class="line">        <span class="attr">"qr_code_url"</span>: <span class="string">"weixin://wxpay/bizpayurl?pr=ZObbdsW"</span>,</span><br><span class="line">        <span class="attr">"currency_rate"</span>: <span class="string">"5.13710"</span>,</span><br><span class="line">        <span class="attr">"merchant_reference"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="attr">"signature"</span>: <span class="string">"cf56a6bbe1aa42e1c273c4d7fe6233f70a6b10ba39e88938b13469f3315e4c41"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SHA-256-HMAC签名"><a href="#SHA-256-HMAC签名" class="headerlink" title="SHA-256 HMAC签名"></a>SHA-256 HMAC签名</h4><p>将<code>data</code>中的数据按照字母顺序排列（去掉<code>signature</code>和其他null值或空字符串值）然后用<code>&amp;</code>拼接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">待签名文本: amount=1.00&amp;amount_cny=5.00&amp;currency=NZD&amp;currency_rate=5.29930&amp;merchant_reference=dsi39ej430sks03&amp;nonce=7d5a88119354301ad3fc250404493bd27abf4467283a061d1ed11860a46e1bf3&amp;order_id=20170829-alipay-3990527237343&amp;organisation_id=18&amp;org_name=Latipay&amp;payment_method=alipay&amp;product_name=test&amp;qr_code=https://qr.alipay.com/bax03286h4vlfpxldgwq4035&amp;type=Online&amp;user_id=U000000051&amp;wallet_id=W000000037&amp;wallet_name=aud01</span><br><span class="line">密钥: api_key</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="3-支付结果异步通知"><a href="#3-支付结果异步通知" class="headerlink" title="3. 支付结果异步通知"></a>3. 支付结果异步通知</h3><p>此接口为商户端后台提供，在支付完成后，Latipay服务器每隔30秒调用该接口，直到收到“sent”文本，在调用该接口时，Latipay会传入支付结果信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST 商户端的 callback_url</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br></pre></td></tr></table></figure>
<h4 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>merchant_reference</td>
<td>String</td>
<td>商户订单id</td>
</tr>
<tr>
<td>currency</td>
<td>String</td>
<td>支付币种</td>
</tr>
<tr>
<td>amount</td>
<td>String</td>
<td>支付金额</td>
</tr>
<tr>
<td>payment_method</td>
<td>String</td>
<td>支付方式</td>
</tr>
<tr>
<td>status</td>
<td>String</td>
<td>支付状态，值可能为: pending, paid, 或 failed.</td>
</tr>
<tr>
<td>pay_time</td>
<td>String</td>
<td>支付时间，北京时间 <code>UTC/GMT+08:00</code></td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>参数签名，算法为SHA-256 HMAC</td>
</tr>
</tbody>
</table>
<h4 id="参数例子-1"><a href="#参数例子-1" class="headerlink" title="参数例子"></a>参数例子</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"signature"</span>: <span class="string">"14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3"</span>,</span><br><span class="line">  <span class="attr">"merchant_reference"</span>: <span class="string">"dsi39ej430sks03"</span>,</span><br><span class="line">  <span class="attr">"currency"</span>: <span class="string">"AUD"</span>,</span><br><span class="line">  <span class="attr">"amount"</span>: <span class="string">"120.00"</span>,</span><br><span class="line">  <span class="attr">"payment_method"</span>: <span class="string">"wechat"</span>,</span><br><span class="line">  <span class="attr">"status"</span>: <span class="string">"paid"</span>,</span><br><span class="line">  <span class="attr">"pay_time"</span>: <span class="string">"2017-07-07 10:53:50"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SHA-256-HMAC签名-1"><a href="#SHA-256-HMAC签名-1" class="headerlink" title="SHA-256 HMAC签名"></a>SHA-256 HMAC签名</h4><p>商户端后台需要验证该签名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">待签名文本: merchant_reference + payment_method + status + currency + amount</span><br><span class="line">密钥: api_key</span><br></pre></td></tr></table></figure>
<h4 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h4><p>Latipay服务器期望收到此文本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sent</span><br></pre></td></tr></table></figure>
<h3 id="4-支付成功后浏览器重定向"><a href="#4-支付成功后浏览器重定向" class="headerlink" title="4. 支付成功后浏览器重定向"></a>4. 支付成功后浏览器重定向</h3><p class="tip">此功能仅支持PC浏览器或者微信支付。支付宝App扫码支付成功后，支付宝App并不会跳转。</p>

<p>客户端支付完成后，会跳转到return_url，并传入以下参数</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>merchant_reference</td>
<td>String</td>
<td>商户订单id</td>
</tr>
<tr>
<td>payment_method</td>
<td>String</td>
<td>支付方式，可能值：alipay, wechat, onlineBank</td>
</tr>
<tr>
<td>status</td>
<td>String</td>
<td>支付状态，可能值: pending, paid, 或 failed</td>
</tr>
<tr>
<td>currency</td>
<td>String</td>
<td>支付币种</td>
</tr>
<tr>
<td>amount</td>
<td>String</td>
<td>支付金额</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>服务器端签名，算法为SHA-256 HMAC</td>
</tr>
</tbody>
</table>
<h4 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.merchant.com/latipay?merchant_reference=dsi39ej430sks03&amp;payment_method=alipay&amp;status=paid&amp;currency=NZD&amp;amount=100.00&amp;signature= 14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3</span><br></pre></td></tr></table></figure>
<h4 id="服务器端-SHA-256-HMAC-签名"><a href="#服务器端-SHA-256-HMAC-签名" class="headerlink" title="服务器端 SHA-256 HMAC 签名"></a>服务器端 SHA-256 HMAC 签名</h4><p>商户端前端可以考虑验证该签名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">待签名文本: merchant_reference + payment_method + status + currency + amount</span><br><span class="line">密钥: api_key</span><br></pre></td></tr></table></figure>
<h3 id="5-查询支付"><a href="#5-查询支付" class="headerlink" title="5. 查询支付"></a>5. 查询支付</h3><p>向Latipay服务器查询订单支付信息，merchant_reference为商户端订单id。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.latipay.net/v2/transaction/&#123;merchant_reference&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>String</td>
<td>商户账号用户 id</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>参数签名，算法为SHA-256 HMAC</td>
</tr>
</tbody>
</table>
<h4 id="SHA-256-HMAC-签名"><a href="#SHA-256-HMAC-签名" class="headerlink" title="SHA-256 HMAC 签名"></a>SHA-256 HMAC 签名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">待签名文本: merchant_reference + user_id</span><br><span class="line">密钥: api_key</span><br></pre></td></tr></table></figure>
<h4 id="结果-2"><a href="#结果-2" class="headerlink" title="结果"></a>结果</h4><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>merchant_reference</td>
<td>String</td>
<td>商户订单id</td>
</tr>
<tr>
<td>currency</td>
<td>String</td>
<td>支付币种</td>
</tr>
<tr>
<td>amount</td>
<td>String</td>
<td>支付金额</td>
</tr>
<tr>
<td>payment_method</td>
<td>String</td>
<td>支付方式，可能值：alipay, wechat, onlineBank</td>
</tr>
<tr>
<td>status</td>
<td>String</td>
<td>支付状态，可能值: pending, paid, 或 failed</td>
</tr>
<tr>
<td>pay_time</td>
<td>String</td>
<td>支付时间，北京时间 <code>UTC/GMT+08:00</code></td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td>服务器端签名，算法为SHA-256 HMAC</td>
</tr>
</tbody>
</table>
<h4 id="参数例子-2"><a href="#参数例子-2" class="headerlink" title="参数例子"></a>参数例子</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"signature"</span>: <span class="string">"14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3"</span>,</span><br><span class="line">  <span class="attr">"merchant_reference"</span>: <span class="string">"dsi39ej430sks03"</span>,</span><br><span class="line">  <span class="attr">"currency"</span>: <span class="string">"AUD"</span>,</span><br><span class="line">  <span class="attr">"amount"</span>: <span class="string">"120.00"</span>,</span><br><span class="line">  <span class="attr">"payment_method"</span>: <span class="string">"wechat"</span>,</span><br><span class="line">  <span class="attr">"status"</span>: <span class="string">"paid"</span>,</span><br><span class="line">  <span class="attr">"pay_time"</span>: <span class="string">"2017-07-07 10:53:50"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="signature-服务器端签名-1"><a href="#signature-服务器端签名-1" class="headerlink" title="signature 服务器端签名"></a>signature 服务器端签名</h4><p>服务器端返回结果前会对支付结果加密，商户端需要进行验证，以保证该请求的合法性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">加密文本: merchant_reference + payment_method + status + currency + amount</span><br><span class="line">密钥: api_key</span><br></pre></td></tr></table></figure>
<h4 id="例子-3"><a href="#例子-3" class="headerlink" title="例子"></a>例子</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">加密文本: dsi39ej430sks03alipaypaidNZD120.00</span><br><span class="line">密钥: 111222333</span><br><span class="line">signature: 840151e0dc39496e22b410b83058b4ddd633b786936c505ae978fae029a1e0f1</span><br></pre></td></tr></table></figure>

  
  <div class="footer">
  </div>
</div>

        
      </div>
      <script src="/js/smooth-scroll.min.js"></script>
    

    <!-- main custom script for sidebars, version selects etc. -->
    <script src="/js/css.escape.js"></script>
    <script src="/js/common.js"></script>


    <!-- fastclick -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      FastClick.attach(document.body)
    }, false)
    </script>
  </body>
</html>

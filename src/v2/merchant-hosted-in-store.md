---
title: Merchant Hosted - In-Store
type: v2
order: 5
---
[Download PDF](/pdf/merchant-hosted-in-store.pdf)

Powerful and robust online payment solutions, which work on a range of platforms which include website, billing software and Applications. Latipay provides partnership merchants with the interface for developing custom built payment solution for your own sub-merchants.

## How it works?
To process a `in-store` transaction, Latipay partnership merchants load [#Transaction Interface](#Transaction-Interface-WeChat-and-Alipay) and [#Payment Interface](#Payment-Interface) api to a QR Code text. Customers scan the QR Code to make the payment.

* the **Merchant** means Latipay partnership merchant.

1. sub-merchant input order information in **Merchant** website and request to pay.

2. **Merchant** server load [#Transaction Interface](#Transaction-Interface-WeChat-and-Alipay) and [#Payment Interface](#Payment-Interface) api for getting a QR Code text. 

2. **Merchant** website generates QR Code from the text and display it in the website.

3. Customers scan the QR Code with Alipay app or Wechat app and finish the payment.


## Payment Scenarios

#### Alipay

![](http://latipay.net/wp-content/uploads/images/Alipay_MerchantHosted.png)

--- 

#### WeChat Pay

![](http://latipay.net/wp-content/uploads/images/Wechat_MerchantHosted.png)

--- 

## API List

### Transaction Interface - WeChat and Alipay
	
```
POST https://api.latipay.net/v2/transaction
```
	
#### Parameters:		


| Name  | Type  | Description | Nullable | 
|------------- |---------------| -------------| -------------|
| signature| String| The SHA-256 HMAC API signature.| No|
| wallet_id| String| The ID of the wallet you want to use.| No|
| amount| String| A decimal amount.| No|
| user_id| String| The user account you want to use to process the transaction.| No|
| merchant_reference| String| A field for identifying your transaction.| No|
| currency| String| The currency code of the transaction.| No|
| return_url| String| The URL of the landing page where Latipay will return the customer after payment.| No|
| callback_url| String| The URL of the callback address the transaction notification is sent after payment.| No|
| ip| String| The IP address of the customer.| No|
| version| String| The latest version of the platform.| No|
| product_name| String| The name of the product or service being sold.| No|
| payment_method| String| Payment method options are wechat, alipay.| No|
| host_type| String| must be "1", which means Merchant hosted.| No|

### Extra Parameter for alipay
| Name  | Type  | Description | Nullable | 
|------------- |---------------| -------------| -------------|
| is_spotpay| String| must be "1" | No|

#### Example Parameters

```json
{
  "signature": "14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3",
  "wallet_id": "W00000001",
  "amount": "120.00",
  "user_id": "U000334333",
  "merchant_reference": "dsi39ej430sks03",
  "currency": "AUD",
  "return_url": "https://merchantsite.com/checkout",
  "callback_url": "https://merchantsite.com/confirm",
  "ip": "122.122.122.1",
  "version": "2.0",
  "product_name": "Pinot Noir, Otago",
  "payment_method": "alipay",
  "host_type" : "1"
}
```

#### SHA-256 HMAC Signature
```
message: user_id + wallet_id + amount + payment_method + return_url + callback_url
secret: api_key
```

#### Example Signature

```
message: U000000001W000000010.01alipayhttp://merchant.com/returnhttp://merchant.com/callback
secret: 111222333

signature: 2367bcd9e9a2f9a547c85d7545d1217702a574b8084bbb7ae33b45a03a89983
```

#### Response

```json
{
  "signature": "14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3",
  "host_url": "https://api.latipay.net/merchanthosted/gatewaydata",
  "nonce": "7d5a88119354301ad3fc250404493bd27abf4467283a061d1ed11860a46e1bf3"
}
```

| Name  | Type  | Description | 
|------------- |---------------| -------------| 
|signature | String | The SHA-256 HMAC API signature. | 
|host_url | String | The host URL to send your customer. The nonce should be appended to the end. | 
|nonce | String | The transaction nonce must be appended to the pay URL. | 


#### Signature in Response
For security reasons, we highly recommend you verify the signature in the response.

```
message: nonce + host_url
secret: api_key
```

### Payment Interface

```
POST {host_url}/{nonce}
```

#### Example

```
https://api.latipay.net/merchanthosted/gatewaydata/7d5a88119354301ad3fc250404493bd27abf4467283a061d1ed11860a46e1bf3
```

#### Response

| Name  | Type  | Description | 
|------------- |---------------| -------------| 
|code | Integer | The response code of payment, 0 or error code.
|message | String | The response message of payment interface.
|data | Object | The response of payment interface.

the `data` object

| Name  | Type  | Description | 
|------------- |---------------| -------------| 
| order_id | String | A unique transaction identifier generated by Latipay. |
| nonce | String | A unique transaction nonce generated by Latipay. |
| payment_method | String | Payment method options are wechat, alipay. |
| amount | String | A decimal amount. |
| amount_cny | String | A decimal amount. |
| currency | String | The currency code of the transaction. |
| product_name | String | The name of the product or service being sold. |
|organisation_id | Integer | The merchant id which is used to process the transaction. |
|org_name | String | The merchant's name |
|user_id | String | The user account which is used to process the transaction. |
|user_name | String | The user account's name |
|wallet_id | String | The user wallet account which is used to process the transaction. |
|wallet_name | String | The wallet account's name |
|qr_code | String | The QR code is generate by Latipay or third gateway. |
|currency_rate | String | The rate which is used to the transaction. |
|merchant_reference | String | A field for identifying your transaction. |
|signature | String | The SHA-256 HMAC API signature. |

#### Example

```json
{
    "code": 0,
    "message": "SUCCESS",
    "data": {
        "order_id" : "20170829-alipay-3990527237343",
        "nonce" : "7d5a88119354301ad3fc250404493bd27abf4467283a061d1ed11860a46e1bf3",
        "payment_method" : "alipay",
        "amount" : "1.00",
        "amount_cny" : "5.00",
        "currency" : "NZD",
        "product_name" : "test",
        "organisation_id": 18,
        "org_name" : "Latipay",
        "user_id" : "U000000051",
        "user_name" : "Latipay test",
        "wallet_id" : "W000000037",
        "wallet_name" : "aud01",
        "qr_code" : "https://qr.alipay.com/bax03286h4vlfpxldgwq4035",
        "currency_rate" : "5.29930",
        "merchant_reference" : "dsi39ej430sks03",
        "signature":"25e6e72cc6sdfecger95713afb101015aasdf3ca5faf3sdeer851f9cb7fb008a"
    }
}
```

#### SHA-256 HMAC Signature
Rearrange parameters in the `data` set alphabetically (except `signature` and other parameters with value of null or empty string) And connect rearranged parameters with &ï¼š

```
message: amount=1.00&amount_cny=5.00&currency=NZD&currency_rate=5.29930&merchant_reference=dsi39ej430sks03&nonce=7d5a88119354301ad3fc250404493bd27abf4467283a061d1ed11860a46e1bf3&order_id=20170829-alipay-3990527237343&organisation_id=18&org_name=Latipay&payment_method=alipay&product_name=test&qr_code=https://qr.alipay.com/bax03286h4vlfpxldgwq4035&type=Online&user_id=U000000051&wallet_id=W000000037&wallet_name=aud01
secret: api_key
```

### Payment Result Asynchronous Notification

There is an asynchronous and back-end payment result notification sent by Latipay to merchant after the payment is done successfully. There is a re-try mechanism with the notification to ensure the notification could be delivered to the merchant.


```
POST merchant's callback_url
```

#### Parameters:		


| Name  | Type  | Description | 
|------------- |---------------| -------------|
| signature | String | The SHA-256 HMAC API signature. |  
| transaction_id | String | f66f-4f1b-9ef5-43cb917ff8a6 (string) - A unique transaction identifier generated by Latipay. | 
| merchant_reference | String | A field for identifying your transaction. | 
| currency | String | The currency code of the transaction. |
| amount | String | A decimal amount. |
| payment_method | String | The payment method used. Possible values are wechat, alipay. |
| status | String | The status of the transaction. Possible values are: pending, paid, or failed. |
| pay_time | String | Show the payment time of the transaction order. |

#### Example input

```json
{
  "signature": "14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3",
  "transaction_id": "20170707-wechat-3473511594933",
  "merchant_reference": "dsi39ej430sks03",
  "currency": "AUD",
  "amount": "120.00",
  "payment_method": "wechat",
  "status": "paid",
  "pay_time": "2017-07-07 10:53:50"
}
```


#### SHA-256 HMAC Signature
Merchant backend need to validate the signature for protecting against malicious requests.

```
message: merchant_reference + payment_method + status + currency + amount
secret: api_key
```

#### Expected the text "sent" in Response's body

```
sent
```

### Query Interface
All customers can send request to search their transaction order by merchant order id(that should be unique id for the merchant) as merchant_reference by HTTP GET request.

```
GET https://api.latipay.net/v2/transaction/{merchant_reference}
```

#### Parameters

| Name  | Type  | Description | 
|------------- |---------------| -------------|
| signature | String | The SHA-256 HMAC API signature. |
| user_id | String | The user account you want to use to process the transaction. |

#### Example Parameters

```json
{
  "signature": "14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3",
  "user_id": "U000334333"
}
```

#### SHA-256 HMAC Signature

```
message: merchant_reference + user_id
secret: api_key
```

#### Response

| Name  | Type  | Description | 
|------------- |---------------| -------------|
| signature | String | The SHA-256 HMAC API signature. |
| transaction_id | String | A unique transaction identifier generated by Latipay. |
| merchant_reference | String | A field for identifying your transaction. |
| currency | String | The currency code of the transaction. |
| amount | String | A decimal amount. |
| payment_method | String | The payment method used. Possible values are wechat, alipay. |
| status | String | The status of the transaction. Possible values are: pending, paid, or failed. |
| pay_time | String | Show the payment time of the transaction order. | 

#### Example Response

```json
{
  "signature": "14d5b06a2a5a2ec509a148277ed4cbeb3c43301b239f080a3467ff0aba4070e3",
  "transaction_id": "20170707-wechat-3473511594933",
  "merchant_reference": "dsi39ej430sks03",
  "currency": "AUD",
  "amount": "120.00",
  "payment_method": "wechat",
  "status": "paid",
  "pay_time": "2017-07-07 10:53:50"
}
```

#### Signature in Response
For security reasons, we highly recommend you verify the signature in the response.

```
message: merchant_reference + payment_method + status + currency + amount
secret: api_key
```
